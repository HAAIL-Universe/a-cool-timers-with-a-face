{
  "stack": {
    "auth": null,
    "database": "postgresql",
    "frontend": "react",
    "test_framework": "pytest",
    "llm_integration": null,
    "backend_language": "python",
    "backend_framework": "fastapi"
  },
  "phases": [
    {
      "name": "Backend Foundation \u2014 In-Memory Timer Engine",
      "number": 0,
      "purpose": "Stand up the FastAPI application with an in-memory timer repository, a TimerService containing all countdown/urgency logic, and the full REST API surface defined by the physics contract.",
      "exemptions": [
        "No database \u2014 schema tables are modelled as in-memory Pydantic objects only"
      ],
      "file_manifest": [
        {
          "path": "app/__init__.py",
          "layer": "entrypoint",
          "action": "create",
          "description": "Empty package marker for the app module."
        },
        {
          "path": "app/main.py",
          "layer": "entrypoint",
          "action": "create",
          "description": "FastAPI app factory: registers routers, CORS middleware, and root health endpoint."
        },
        {
          "path": "app/config.py",
          "layer": "infrastructure",
          "action": "create",
          "description": "Pydantic Settings model reading CORS_ORIGINS and DEFAULT_DURATION_SECONDS from .env."
        },
        {
          "path": "app/models/timer.py",
          "layer": "model",
          "action": "create",
          "description": "Pydantic models: TimerCreateRequest, Timer, TimerState, ColourIntensity matching physics contract schemas."
        },
        {
          "path": "app/repos/__init__.py",
          "layer": "repo",
          "action": "create",
          "description": "Empty package marker."
        },
        {
          "path": "app/repos/timer_repo.py",
          "layer": "repo",
          "action": "create",
          "description": "In-memory dict-backed TimerRepo: create, get, list, update, delete timer records by UUID."
        },
        {
          "path": "app/services/__init__.py",
          "layer": "service",
          "action": "create",
          "description": "Empty package marker."
        },
        {
          "path": "app/services/timer_service.py",
          "layer": "service",
          "action": "create",
          "description": "TimerService: start/pause/reset/delete timer logic, urgency level calculation, colour RGB derivation, and facial expression mapping."
        },
        {
          "path": "app/routers/__init__.py",
          "layer": "router",
          "action": "create",
          "description": "Empty package marker."
        },
        {
          "path": "app/routers/timers.py",
          "layer": "router",
          "action": "create",
          "description": "FastAPI router: POST /timers, GET /timers, GET /timers/{timerId}, DELETE /timers/{timerId}, POST /timers/{timerId}/reset, GET /timers/{timerId}/state."
        },
        {
          "path": "app/dependencies.py",
          "layer": "infrastructure",
          "action": "create",
          "description": "FastAPI dependency providers: singleton TimerRepo and TimerService instances."
        },
        {
          "path": "requirements.txt",
          "layer": "infrastructure",
          "action": "create",
          "description": "Pinned Python dependencies: fastapi, uvicorn[standard], pydantic, pydantic-settings, python-dotenv, pytest, httpx."
        },
        {
          "path": ".env.example",
          "layer": "infrastructure",
          "action": "create",
          "description": "Example env file with CORS_ORIGINS and DEFAULT_DURATION_SECONDS placeholders."
        },
        {
          "path": "tests/__init__.py",
          "layer": "test",
          "action": "create",
          "description": "Empty package marker for tests."
        },
        {
          "path": "tests/test_timer_service.py",
          "layer": "test",
          "action": "create",
          "description": "Pytest unit tests for TimerService: urgency calculation, colour mapping, reset logic, expiry detection."
        },
        {
          "path": "tests/test_timers_router.py",
          "layer": "test",
          "action": "create",
          "description": "Pytest integration tests using httpx.AsyncClient for all six timer endpoints."
        }
      ],
      "wires_from_phase": null,
      "acceptance_criteria": [
        {
          "id": "AC-0-1",
          "test_hint": "manual: curl http://localhost:8000/",
          "description": "uvicorn app.main:app --reload starts without errors and GET / returns 200."
        },
        {
          "id": "AC-0-2",
          "test_hint": "tests/test_timers_router.py::test_create_timer",
          "description": "POST /timers with {\"duration\": 30} returns 201 with a valid UUID id and status='active'."
        },
        {
          "id": "AC-0-3",
          "test_hint": "tests/test_timers_router.py::test_get_timer_state",
          "description": "GET /timers/{timerId}/state returns urgencyLevel, colourIntensity (RGB), and facialExpression fields."
        },
        {
          "id": "AC-0-4",
          "test_hint": "tests/test_timers_router.py::test_reset_timer",
          "description": "POST /timers/{timerId}/reset resets remainingTime to initialDuration."
        },
        {
          "id": "AC-0-5",
          "test_hint": "tests/test_timer_service.py::test_urgency_thresholds",
          "description": "Urgency transitions at >50% \u2192 low, 25\u201350% \u2192 medium, 10\u201325% \u2192 high, <10% \u2192 critical."
        },
        {
          "id": "AC-0-6",
          "test_hint": "pytest -x",
          "description": "pytest -x passes with all tests green."
        }
      ],
      "schema_tables_claimed": [
        "timers",
        "timer_sessions",
        "timer_events"
      ]
    },
    {
      "name": "Frontend Shell \u2014 Timer Display & Controls",
      "number": 1,
      "purpose": "Scaffold the React/Vite/TypeScript frontend with the core timer UI: countdown display, start/pause/reset buttons, and live polling of the backend state endpoint every second.",
      "exemptions": [],
      "file_manifest": [
        {
          "path": "web/package.json",
          "layer": "infrastructure",
          "action": "create",
          "description": "Vite + React + TypeScript project manifest with vitest, @testing-library/react dependencies."
        },
        {
          "path": "web/vite.config.ts",
          "layer": "infrastructure",
          "action": "create",
          "description": "Vite config: React plugin, proxy /api \u2192 http://localhost:8000 to avoid CORS in dev."
        },
        {
          "path": "web/tsconfig.json",
          "layer": "infrastructure",
          "action": "create",
          "description": "TypeScript compiler config for strict React/Vite project."
        },
        {
          "path": "web/index.html",
          "layer": "infrastructure",
          "action": "create",
          "description": "HTML entry point mounting the React app root."
        },
        {
          "path": "web/src/main.tsx",
          "layer": "entrypoint",
          "action": "create",
          "description": "React app entry point rendering App into #root."
        },
        {
          "path": "web/src/App.tsx",
          "layer": "entrypoint",
          "action": "create",
          "description": "Root App component: initialises timer session on mount, wires TimerContainer."
        },
        {
          "path": "web/src/types/timer.ts",
          "layer": "model",
          "action": "create",
          "description": "TypeScript interfaces: Timer, TimerState, ColourIntensity, UrgencyLevel, FacialExpression matching physics contract schemas."
        },
        {
          "path": "web/src/api/timerApi.ts",
          "layer": "infrastructure",
          "action": "create",
          "description": "Typed fetch wrappers for all timer endpoints: createTimer, getTimerState, resetTimer, startTimer, pauseTimer, deleteTimer."
        },
        {
          "path": "web/src/hooks/useTimer.ts",
          "layer": "service",
          "action": "create",
          "description": "Custom hook: manages timerId in state, polls /timers/{id}/state every 1000ms via setInterval, exposes timerState, isRunning, start, pause, reset handlers."
        },
        {
          "path": "web/src/components/TimerContainer.tsx",
          "layer": "router",
          "action": "create",
          "description": "Main layout wrapper component composing TimerDisplay, FacialAvatar, BackgroundBar, ResetButton, StartPauseButton."
        },
        {
          "path": "web/src/components/TimerDisplay.tsx",
          "layer": "router",
          "action": "create",
          "description": "MM:SS countdown display: large monospace font, colour driven by urgencyLevel prop."
        },
        {
          "path": "web/src/components/ResetButton.tsx",
          "layer": "router",
          "action": "create",
          "description": "Arcade-styled RESET button with disabled state when timer is not running."
        },
        {
          "path": "web/src/components/StartPauseButton.tsx",
          "layer": "router",
          "action": "create",
          "description": "Arcade-styled START/PAUSE toggle button driven by isRunning prop."
        },
        {
          "path": "web/src/components/BackgroundBar.tsx",
          "layer": "router",
          "action": "create",
          "description": "Full-screen background component: applies urgency colour from colourIntensity RGB values with 500ms CSS transition."
        },
        {
          "path": "web/src/styles/global.css",
          "layer": "infrastructure",
          "action": "create",
          "description": "Global CSS: retro arcade font stack, CSS custom properties for urgency palette, pixelated image-rendering, button arcade styling."
        },
        {
          "path": "web/src/tests/useTimer.test.ts",
          "layer": "test",
          "action": "create",
          "description": "Vitest unit tests for useTimer hook: polling behaviour, state transitions, reset call."
        }
      ],
      "wires_from_phase": 0,
      "acceptance_criteria": [
        {
          "id": "AC-1-1",
          "test_hint": "manual: npm run dev",
          "description": "npm run dev in web/ starts Vite dev server on port 5173 without errors."
        },
        {
          "id": "AC-1-2",
          "test_hint": "manual: browser at http://localhost:5173",
          "description": "App renders a countdown timer in MM:SS format that counts down from the default duration."
        },
        {
          "id": "AC-1-3",
          "test_hint": "manual: interaction test in browser",
          "description": "START button begins the countdown; PAUSE button freezes it; background updates colour."
        },
        {
          "id": "AC-1-4",
          "test_hint": "manual: click RESET mid-countdown",
          "description": "RESET button resets the countdown to the initial duration and returns background to green."
        },
        {
          "id": "AC-1-5",
          "test_hint": "web/src/tests/useTimer.test.ts",
          "description": "npm test (vitest) passes useTimer hook tests."
        }
      ],
      "schema_tables_claimed": []
    },
    {
      "name": "8-Bit Face, Urgency Animations & Full Polish",
      "number": 2,
      "purpose": "Implement the pixel-art LED facial avatar with four expression states, add smooth CSS colour transitions, pulse animation in critical zone, keyboard shortcuts, and duration configuration UI.",
      "exemptions": [],
      "file_manifest": [
        {
          "path": "web/src/components/FacialAvatar.tsx",
          "layer": "router",
          "action": "create",
          "description": "16x16 CSS-grid pixel-art face: renders calm, concerned, stressed, critical expressions based on expression prop; applies urgency colour tint and pulse animation class."
        },
        {
          "path": "web/src/components/FacialAvatar.css",
          "layer": "infrastructure",
          "action": "create",
          "description": "CSS for pixel grid, per-expression pixel colour maps, pulse keyframe animation (0.5\u20131s cycle), and critical-zone rapid-flash class."
        },
        {
          "path": "web/src/components/DurationPicker.tsx",
          "layer": "router",
          "action": "create",
          "description": "Preset duration selector (30s, 60s, 90s, 120s) shown only when timer is stopped; calls createTimer with chosen duration."
        },
        {
          "path": "web/src/hooks/useUrgencyStyle.ts",
          "layer": "service",
          "action": "create",
          "description": "Hook deriving inline CSS background-color and transition values from ColourIntensity RGB; adds pulse CSS class when urgencyLevel is 'critical'."
        },
        {
          "path": "web/src/hooks/useKeyboardShortcuts.ts",
          "layer": "service",
          "action": "create",
          "description": "Hook binding spacebar \u2192 start/pause toggle, R key \u2192 reset, as per UI contract accessibility requirement."
        },
        {
          "path": "web/src/styles/animations.css",
          "layer": "infrastructure",
          "action": "create",
          "description": "Shared keyframe animations: urgency-pulse, screen-flash, face-expression-shift (200\u2013300ms ease-in-out)."
        },
        {
          "path": "web/src/tests/FacialAvatar.test.tsx",
          "layer": "test",
          "action": "create",
          "description": "Vitest + Testing Library tests: correct pixel class applied per expression state, pulse class present only in critical urgency."
        },
        {
          "path": "web/src/tests/useUrgencyStyle.test.ts",
          "layer": "test",
          "action": "create",
          "description": "Vitest unit tests: correct RGB hex derivation and CSS class selection for each urgency level."
        },
        {
          "path": "app/services/urgency_calculator.py",
          "layer": "service",
          "action": "create",
          "description": "Extracted pure functions for urgency threshold logic and RGB colour interpolation, imported by TimerService."
        },
        {
          "path": "app/services/timer_service.py",
          "layer": "service",
          "action": "modify",
          "description": "Refactor to import from urgency_calculator; no logic change \u2014 extraction only."
        },
        {
          "path": "tests/test_urgency_calculator.py",
          "layer": "test",
          "action": "create",
          "description": "Pytest parametrized tests covering all urgency boundary conditions and RGB edge values."
        }
      ],
      "wires_from_phase": 1,
      "acceptance_criteria": [
        {
          "id": "AC-2-1",
          "test_hint": "web/src/tests/FacialAvatar.test.tsx",
          "description": "FacialAvatar renders distinct 16x16 pixel layouts for calm, concerned, stressed, and critical expressions."
        },
        {
          "id": "AC-2-2",
          "test_hint": "manual: run a 30-second countdown and observe colour shift",
          "description": "Background colour transitions smoothly (500ms CSS) through green \u2192 yellow \u2192 orange \u2192 red as timer depletes."
        },
        {
          "id": "AC-2-3",
          "test_hint": "manual: let timer reach <3s on a 30s countdown",
          "description": "Pulse animation activates on both face and background when urgencyLevel is 'critical' (<10% remaining)."
        },
        {
          "id": "AC-2-4",
          "test_hint": "manual keyboard test + web/src/tests/useUrgencyStyle.test.ts",
          "description": "Spacebar toggles start/pause; R key resets \u2014 verified in browser and unit test."
        },
        {
          "id": "AC-2-5",
          "test_hint": "manual: change preset before starting timer",
          "description": "DurationPicker allows selecting 30/60/90/120s presets; new timer session created with chosen duration."
        },
        {
          "id": "AC-2-6",
          "test_hint": "pytest -x && cd web && npm test",
          "description": "All pytest and vitest suites pass with no failures."
        }
      ],
      "schema_tables_claimed": []
    }
  ],
  "summary": {
    "mode": "greenfield",
    "one_liner": "A retro 8-bit fitness countdown timer with colour-coded urgency feedback and pixel-art facial expressions, backed by FastAPI in-memory state and a React/Vite frontend.",
    "key_constraints": [
      "MINI-BUILD: no authentication, no user table, no Docker \u2014 public endpoints only",
      "All timer state is in-memory (Python dict); no database persistence in MVP",
      "Schema DB tables are deferred \u2014 in-memory repo mirrors the schema shapes",
      "Routers must never import repos directly \u2014 always go through services (boundaries contract)",
      "Urgency colour and facial expression must be derived server-side on /timers/{timerId}/state",
      "Frontend polls /timers/{timerId}/state every second for live updates (no WebSocket in Phase 0)",
      "8-bit pixel face is rendered via CSS grid / inline SVG \u2014 no external sprite assets required",
      "CORS_ORIGINS env var required; DATABASE_URL and JWT_SECRET are omitted (mini-build)"
    ],
    "stack_rationale": "FastAPI provides a lightweight, zero-boilerplate backend ideal for in-memory session state and a thin REST API. React + Vite gives fast HMR and full TypeScript support for the component-heavy, animation-driven UI. No database is required because state is transient per session, keeping the mini-build simple and locally runnable with just pip + npm.",
    "missing_contracts": [],
    "existing_contracts": [
      "blueprint.md",
      "stack.md",
      "schema.md",
      "manifesto.md",
      "physics.yaml",
      "boundaries.json",
      "ui.md"
    ],
    "boot_script_required": false
  },
  "metadata": {
    "generated_at": "2026-02-24T13:12:03.323707+00:00",
    "project_name": "cool-timers-with-a-face",
    "planner_model": "claude-sonnet-4-6",
    "schema_version": "1.0"
  },
  "contract_refs": [
    {
      "note": "Defines the exact six REST endpoints implemented in app/routers/timers.py",
      "section": "paths \u2014 /timers and /timers/{timerId}/state",
      "contract": "physics.yaml"
    },
    {
      "note": "Fields urgencyLevel, colourIntensity (RGB), facialExpression drive both server response and frontend rendering",
      "section": "components/schemas/TimerState",
      "contract": "physics.yaml"
    },
    {
      "note": "Routers must not import repos \u2014 enforces router \u2192 service \u2192 repo layering throughout",
      "section": "routers layer forbidden imports",
      "contract": "boundaries.json"
    },
    {
      "note": "Four expression states (calm/concerned/stressed/critical) map to urgency levels for FacialAvatar component",
      "section": "\u00a72 8-Bit Facial Avatar expression states",
      "contract": "ui.md"
    },
    {
      "note": "Arcade-bright hex codes (#00FF00, #FFFF00, #FF8800, #FF0000) used in useUrgencyStyle hook and global.css",
      "section": "\u00a74 Color Palette",
      "contract": "ui.md"
    },
    {
      "note": "urgency_calculator.py must enforce monotonic RGB escalation \u2014 tested in test_urgency_calculator.py",
      "section": "Core Invariants \u2014 colour intensity monotonically increasing",
      "contract": "blueprint.md"
    },
    {
      "note": "Confirms no database is used in MVP; schema tables are in-memory only, overriding stack contract DB reference",
      "section": "Repositories \u2014 In-memory session store",
      "contract": "blueprint.md"
    },
    {
      "note": "Frontend stores current timerId in localStorage so page refresh reconnects to the same in-memory session while alive",
      "section": "\u00a75 Persistent State \u2014 local storage Phase 1",
      "contract": "manifesto.md"
    }
  ],
  "required_contracts": [
    "blueprint.md",
    "physics.yaml",
    "boundaries.json",
    "ui.md",
    "stack.md",
    "schema.md",
    "manifesto.md"
  ]
}